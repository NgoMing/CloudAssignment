{"paragraphs":[{"text":"val keySpace = \"cass_db\"\r\nval table = \"sales_join_price\"\r\n\r\nval fullTable = sqlContext.read.format(\"org.apache.spark.sql.cassandra\").options(Map(\"keyspace\" -> keySpace, \"table\" -> table)).load()\r\nfullTable.createOrReplaceTempView(table)","user":"anonymous","dateUpdated":"2018-10-12T07:34:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"keySpace: String = cass_db\ntable: String = sales_join_price\nfullTable: org.apache.spark.sql.DataFrame = [student_name: string, course_name: string ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1539328072312_1132622948","id":"20181009-160413_1535656301","dateCreated":"2018-10-12T07:07:52+0000","dateStarted":"2018-10-12T07:34:00+0000","dateFinished":"2018-10-12T07:34:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6287"},{"text":"// retrieve records of one partition. \r\nval onePartition = fullTable.select($\"course_name\", $\"rate\") \r\n\r\nz.show(onePartition)","user":"anonymous","dateUpdated":"2018-10-12T07:34:00+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"onePartition: org.apache.spark.sql.DataFrame = [course_name: string, rate: int]\n"},{"type":"TABLE","data":"course_name\trate\nCloud Implementation\t3\nJava Programming\t5\nPerl Programming\t5\nPython Programming\t3\nBig Data Analysis\t5\nCloud Implementation\t3\nJava Programming\t3\nJavaScript Programming\t3\nMachine Learning\t5\nPerl Programming\t4\nPython Programming\t4\nC Programming\t2\nJava Programming\t3\nPython Programming\t3\nWeb Development\t5\n"}]},"apps":[],"jobName":"paragraph_1539328072317_1130699204","id":"20181009-160940_865153544","dateCreated":"2018-10-12T07:07:52+0000","dateStarted":"2018-10-12T07:34:00+0000","dateFinished":"2018-10-12T07:34:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6288"},{"text":"val average = onePartition.as[(String,Float)].map{\r\n    case (course_name, rate) => (course_name, (1, rate))\r\n}.rdd.reduceByKey{\r\n    (a,b) => (a._1+b._1, a._2+b._2)\r\n}.map{\r\n    case (course_name, (count, sum)) => (course_name, sum/count)\r\n}\r\n\r\nval columnNames = Array(\"course\", \"avg_rate\")\r\n\r\nz.show(average.toDF(columnNames:_*))","user":"anonymous","dateUpdated":"2018-10-12T07:34:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"average: org.apache.spark.rdd.RDD[(String, Float)] = MapPartitionsRDD[13] at map at <console>:39\ncolumnNames: Array[String] = Array(course, avg_rate)\n"},{"type":"TABLE","data":"course\tavg_rate\nBig Data Analysis\t5.0\nPerl Programming\t4.5\nMachine Learning\t5.0\nJavaScript Programming\t3.0\nC Programming\t2.0\nCloud Implementation\t3.0\nWeb Development\t5.0\nJava Programming\t3.6666667\nPython Programming\t3.3333333\n"}]},"apps":[],"jobName":"paragraph_1539328072318_1131853451","id":"20181011-022927_279323784","dateCreated":"2018-10-12T07:07:52+0000","dateStarted":"2018-10-12T07:34:03+0000","dateFinished":"2018-10-12T07:34:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6289"},{"text":"val course_average_rate = average.toDF(columnNames:_*).select($\"course\".as(\"course_name\"), $\"avg_rate\".as(\"average_rate\"))\n\ncourse_average_rate.write\n    .format(\"org.apache.spark.sql.cassandra\")\n    .mode(\"append\")\n    .options(Map(\"keyspace\" -> keySpace, \"table\" -> \"course\"))\n    .save()","user":"anonymous","dateUpdated":"2018-10-12T07:34:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"course_average_rate: org.apache.spark.sql.DataFrame = [course_name: string, average_rate: float]\n"}]},"apps":[],"jobName":"paragraph_1539328072318_1131853451","id":"20181011-121832_1417679306","dateCreated":"2018-10-12T07:07:52+0000","dateStarted":"2018-10-12T07:34:15+0000","dateFinished":"2018-10-12T07:34:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:6290"},{"user":"anonymous","dateUpdated":"2018-10-12T07:34:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1539328072319_1131468702","id":"20181011-122256_302853651","dateCreated":"2018-10-12T07:07:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6291"}],"name":"Use Spark map reduce to calculate average","id":"2DTUNNZP7","angularObjects":{"2DRPE7TUA:shared_process":[],"2DRVDGNKY:shared_process":[],"2DTFTKE7C:shared_process":[],"2DU23QZUM:shared_process":[],"2DS63DP4Z:shared_process":[],"2DUXN2TU3:shared_process":[],"2DSSJ2EXQ:shared_process":[],"2DRQSVCQ2:shared_process":[],"2DSF6UJ72:shared_process":[],"2DSKSVWKK:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}